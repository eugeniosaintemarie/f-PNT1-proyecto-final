@model List<EncontraTuMascota.Models.Mascota>

@{
    ViewData["Title"] = "Buscar Mascotas";
    var publicaciones = ViewBag.Publicaciones as List<EncontraTuMascota.Models.Publicacion> ?? new();
}

<div class="buscar-page">
    <div class="page-header">
        <h1>üîç Buscar Mascotas</h1>
        <p class="lead">Encuentra mascotas perdidas en tu zona</p>
    </div>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success">
            @TempData["SuccessMessage"]
        </div>
    }

    <div class="search-section">
        <form method="get" asp-action="Buscar" class="search-form">
            <div class="search-group">
                <input type="text" name="termino" value="@ViewBag.Termino" 
                       class="search-input" placeholder="Buscar por calle o ubicaci√≥n..." />
                <button type="submit" class="btn btn-search">
                    <span>üîé</span> Buscar
                </button>
            </div>
        </form>
    </div>

    <div class="results-section">
        @if (Model != null && Model.Any())
        {
            <h2>Mascotas Encontradas (@Model.Count)</h2>
            <div class="mascotas-grid">
                @foreach (var mascota in Model)
                {
                    var publicacion = publicaciones.FirstOrDefault(p => p.MascotaId == mascota.Id);
                    <div class="mascota-card">
                        <div class="mascota-image">
                            @if (!string.IsNullOrEmpty(mascota.FotoUrl))
                            {
                                <img src="@mascota.FotoUrl" alt="Mascota encontrada" />
                            }
                            else
                            {
                                <div class="no-image">üì∑ Sin imagen</div>
                            }
                        </div>
                        <div class="mascota-info">
                            <h3>Encontrada en: @mascota.CalleEncontrada</h3>
                            <p class="fecha">
                                <strong>Fecha:</strong> @mascota.FechaPublicacion.ToString("dd/MM/yyyy HH:mm")
                            </p>
                            
                            @if (publicacion != null)
                            {
                                <p class="descripcion">@publicacion.Descripcion</p>
                                <p class="contacto">
                                    <strong>üìû Contacto:</strong> @publicacion.Contacto
                                </p>
                            }
                        </div>
                    </div>
                }
            </div>
        }
        else if (!string.IsNullOrWhiteSpace(ViewBag.Termino as string))
        {
            <div class="no-results">
                <p>No se encontraron mascotas con el t√©rmino "<strong>@ViewBag.Termino</strong>"</p>
                <a asp-action="Buscar" class="btn btn-secondary">Ver todas</a>
            </div>
        }
        else
        {
            <div class="no-results">
                <p>üêæ A√∫n no hay mascotas publicadas</p>
                <p>¬øEncontraste una mascota? <a asp-action="Publicar">Publ√≠cala aqu√≠</a></p>
            </div>
        }
    </div>
</div>
