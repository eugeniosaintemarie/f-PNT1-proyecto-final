@model List<EncontraTuMascota.Models.Mascota>

@{
    ViewData["Title"] = "Buscar Mascotas";
    // Traemos las publicaciones que est√°n en el ViewBag (se cargan desde el controller)
    var publicaciones = ViewBag.Publicaciones as List<EncontraTuMascota.Models.Publicacion> ?? new();
}

@* 
    Ac√° es donde busc√°s mascotas perdidas.
    Pod√©s filtrar por ubicaci√≥n o ver todas las que hay publicadas.
*@
<div class="buscar-page">
    <div class="page-header">
        <h1>üîç Buscar mascotas perdidas</h1>
    </div>

    @* Si acab√°s de publicar una mascota, te sale este mensaje de √©xito *@
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success">
            @TempData["SuccessMessage"]
        </div>
    }

    @* Formulario de b√∫squeda por ubicaci√≥n *@
    <div class="search-section">
        <form method="get" asp-action="Buscar" class="search-form">
            <div class="search-group">
                <input type="text" name="termino" value="@ViewBag.Termino" 
                       class="search-input" placeholder="Buscar por calle o ubicaci√≥n" />
                <button type="submit" class="btn btn-search">
                    <span>üîé</span> Buscar
                </button>
            </div>
        </form>
    </div>

    @* Resultados de la b√∫squeda *@
    <div class="results-section">
        @if (Model != null && Model.Any())
        {
            @* Si hay resultados, los mostramos en cards *@
            <h2>Mascotas Encontradas (@Model.Count)</h2>
            <div class="mascotas-grid">
                @foreach (var mascota in Model)
                {
                    // Buscamos la publicaci√≥n asociada a esta mascota
                    var publicacion = publicaciones.FirstOrDefault(p => p.MascotaId == mascota.Id);
                    
                    <div class="mascota-card">
                        @* Foto de la mascota *@
                        <div class="mascota-image">
                            @if (!string.IsNullOrEmpty(mascota.FotoUrl))
                            {
                                <img src="@mascota.FotoUrl" alt="Mascota encontrada" />
                            }
                            else
                            {
                                <div class="no-image">üì∑ Sin imagen</div>
                            }
                        </div>
                        
                        @* Info de la mascota *@
                        <div class="mascota-info">
                            <h3>Encontrada en: @mascota.Ubicacion</h3>
                            <p class="mascota-details">
                                <strong>Sexo:</strong> @mascota.Sexo.ToString() <br />
                                @* Ac√° reemplazamos los nombres de enum por los nombres bonitos *@
                                <strong>Raza:</strong> @mascota.Raza.ToString().Replace("GoldenRetriever", "Golden Retriever")
                                    .Replace("PastorAleman", "Pastor Alem√°n")
                                    .Replace("YorkshireTerrier", "Yorkshire Terrier")
                                    .Replace("HuskySiberiano", "Husky Siberiano")
                                    .Replace("CockerSpaniel", "Cocker Spaniel")
                            </p>
                            <p class="fecha">
                                <strong>Fecha:</strong> @mascota.FechaPublicacion.ToString("dd/MM/yyyy HH:mm")
                            </p>
                            
                            @* Si hay publicaci√≥n, mostramos descripci√≥n y contacto *@
                            @if (publicacion != null)
                            {
                                <p class="descripcion">@publicacion.Descripcion</p>
                                <div class="contacto-box">
                                    <strong>üìû Contacto:</strong><br />
                                    <strong>Nombre:</strong> @mascota.NombreContacto<br />
                                    <strong>Tel√©fono:</strong> @mascota.TelefonoContacto<br />
                                    <strong>Email:</strong> @mascota.EmailContacto
                                </div>
                            }
                        </div>
                    </div>
                }
            </div>
        }
        else if (!string.IsNullOrWhiteSpace(ViewBag.Termino as string))
        {
            @* Si buscaste algo y no hay resultados *@
            <div class="no-results">
                <p>No se encontraron mascotas con el t√©rmino "<strong>@ViewBag.Termino</strong>"</p>
                <a asp-action="Buscar" class="btn btn-secondary">Ver todas</a>
            </div>
        }
        else
        {
            @* Si todav√≠a no hay ninguna mascota publicada *@
            <div class="no-results">
                <p>üêæ A√∫n no hay mascotas publicadas</p>
                <p>¬øEncontraste una mascota? <a asp-action="Publicar">Publ√≠cala ac√°</a></p>
            </div>
        }
    </div>
</div>
